/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-script-daemon",
factory: function (require) {
"use strict";var plugin=(()=>{var Ie=Object.create;var O=Object.defineProperty;var Le=Object.getOwnPropertyDescriptor;var Ue=Object.getOwnPropertyNames;var Me=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var p=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Je=(e,t)=>{for(var r in t)O(e,r,{get:t[r],enumerable:!0})},Y=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ue(t))!je.call(e,i)&&i!==r&&O(e,i,{get:()=>t[i],enumerable:!(n=Le(t,i))||n.enumerable});return e};var W=(e,t,r)=>(r=e!=null?Ie(Me(e)):{},Y(t||!e||!e.__esModule?O(r,"default",{value:e,enumerable:!0}):r,e)),Ve=e=>Y(O({},"__esModule",{value:!0}),e);var ee=v(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.M=g.marshal=g.MarshalError=void 0;function He(e,t){throw new Error(t)}var Z=(e,t)=>t.reduce((r,n)=>typeof n=="string"?`${r}.${n}`:`${r}[${n}]`,e),k=class extends Error{constructor(t,r,n,i){let s=`[At ${Z(t,r)}]: ${n}`;super(s),this.name=t,this.path=r,this.info=n,this.rule=i}};g.MarshalError=k;function h(e,t,r="INPUT",n=[]){function i(o){throw new k(r,n,o,t.kind)}function s(o,c){o||i(c)}switch(t.kind){case"literal":{s(e===t.value,`Expected constant value ${t.value}, got ${e}`);break}case"boolean":{s(typeof e=="boolean",`Expected boolean, got ${typeof e}`);break}case"number":{s(typeof e=="number",`Expected number, got ${typeof e}`);break}case"string":{s(typeof e=="string",`Expected string, got ${typeof e}`);break}case"optional":{e!==void 0&&h(e,t.type,r,n);break}case"object":{typeof e!="object"&&i(`Expected object, got ${typeof e}`),e===null&&i("Expected object, got null"),"__proto__"in e&&e.__proto__!==Object.prototype&&(Array.isArray(e)&&i("Expected object, got array"),i("Encountered prototype pollution"));let o=a=>a.kind!=="literal"?1:a.value==="kind"?-1:0,c=Object.keys(t.fields).sort((a,u)=>{let d=t.fields[a],D=t.fields[u];return o(d)-o(D)});for(let a of c)h(e[a],t.fields[a],r,n.concat([a]));for(let a in e)if(!(a in t.fields))return s(!1,`Found unexpected key: ${a}`);break}case"array":{Array.isArray(e)?e.forEach((o,c)=>h(o,t.type,r,n.concat([c]))):s(!1,`Expected array, got ${typeof e}`);break}case"tuple":{Array.isArray(e)?(s(e.length===t.fields.length,`Invalid tuple size: Expected ${t.fields.length}, got ${e.length}`),e.forEach((o,c)=>h(o,t.fields[c],r,n.concat([c])))):s(!1,`Expected tuple, got ${typeof e}`);break}case"union":{let o=[];if(t.types.some(u=>{try{return h(e,u,r,n),!0}catch(d){if(d instanceof k)return o.push(d),!1;throw d}}))break;let a=[];for(let u of t.types)u.kind==="object"&&"kind"in u.fields&&u.fields.kind.kind==="literal"&&a.push(u.fields.kind.value);if(a.length!==0){for(let u of o)if(u.rule!=="literal"||u.path.length!==n.length+1)throw u;typeof e=="object"&&e!==null&&"kind"in e?s(!1,`Unable to match against union. Found "kind" discriminator: [${e.kind}], but needed one of [${a.join(" | ")}]`):s(!1,`Unable to find "kind" discriminator. Expecting one of [${a.join(" | ")}]`)}else s(!1,`Unable to match against union. Expected one of [${t.types.map(({kind:u})=>u).join(" | ")}]`);break}case"recursive":{h(e,t.self,r,n);break}case"any":case"unknown":break;case"custom":{h(e,t.type,r,n);try{t.fn(e)!==void 0&&i("Custom validation function unexpectedly returned a value")}catch(o){s(!1,o.message)}break}case"record":{typeof e!="object"&&i(`Expected object, got ${typeof e}`),e===null&&i("Expected object, got null"),"__proto__"in e&&e.__proto__!==Object.prototype&&(Array.isArray(e)&&i("Expected object, got array"),i("Encountered prototype pollution")),Object.keys(e).forEach(o=>h(e[o],t.type,r,n.concat([o])));break}case"witness":{h(e,t.type,r,n);break}default:He(t,`Reached unexpected type description "${t.kind}" at ${Z(r,n)}`)}}g.marshal=h;var Ke;(function(e){e.lit=r=>({kind:"literal",value:r}),e.bool={kind:"boolean"},e.num={kind:"number"},e.str={kind:"string"},e.opt=r=>({kind:"optional",type:r}),e.obj=r=>({kind:"object",fields:r}),e.arr=r=>({kind:"array",type:r}),e.tup=(...r)=>({kind:"tuple",fields:r});function t(...r){return{kind:"union",types:r}}e.union=t,e.rec=r=>{let n={kind:"recursive",self:void 0};return n.self=r(n),n},e.any={kind:"any"},e.unk={kind:"unknown"},e.custom=(r,n)=>({kind:"custom",type:r,fn:n}),e.record=r=>({kind:"record",type:r}),e.witness=r=>({kind:"witness",type:r}),e.nul=e.lit(null),e.undef=e.lit(void 0),e.int=e.custom(e.num,r=>{if(!Number.isInteger(r))throw new Error("Expected integer, got non-integer")})})(Ke=g.M||(g.M={}))});var F=v((Pt,ae)=>{var P=p("fs"),ce=p("path"),Xe=p("os");function q(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"}function B(e,t){try{return t(e)}catch(r){if(/^(ENOENT|EPERM|EACCES)$/.test(r.code))return r.code!=="ENOENT"&&console.warn("Warning: Cannot access %s",e),!1;throw r}}var Ye={nil:function(e){return e==null},array:function(e){return Array.isArray(e)},emptyObject:function(e){for(var t in e)return!1;return!0},buffer:function(e){return Buffer.isBuffer(e)},regExp:function(e){return q(e,"RegExp")},string:function(e){return q(e,"String")},func:function(e){return typeof e=="function"},number:function(e){return q(e,"Number")},exists:function(e){return P.existsSync(e)},file:function(e){return B(e,function(t){return P.statSync(t).isFile()})},samePath:function(e,t){return ce.resolve(e)===ce.resolve(t)},directory:function(e){return B(e,function(t){return P.statSync(t).isDirectory()})},symbolicLink:function(e){return B(e,function(t){return P.lstatSync(t).isSymbolicLink()})},windows:function(){return Xe.platform()==="win32"}};ae.exports=Ye});var de=v((At,fe)=>{var b=p("fs"),ue=p("os"),I=p("path"),A=F(),E,Ze=ue.tmpdir&&ue.tmpdir()||process.env.TMPDIR||process.env.TEMP||process.cwd();function pe(){this.stack=[]}pe.prototype={create:function(e,t){var r=I.join(t,"node-watch-"+Math.random().toString(16).substr(2));return this.stack.push({name:r,type:e}),r},write:function(){for(var e=0;e<arguments.length;++e)b.writeFileSync(arguments[e]," ")},mkdir:function(){for(var e=0;e<arguments.length;++e)b.mkdirSync(arguments[e])},cleanup:function(e){try{for(var t;t=this.stack.pop();){var r=t.type,n=t.name;r==="file"&&A.file(n)?b.unlinkSync(n):r==="dir"&&A.directory(n)&&b.rmdirSync(n)}}finally{A.func(e)&&e()}}};var le=!1;fe.exports=function e(t){if(!A.func(t))return!1;if(E!==void 0)return t(E);if(!le)le=!0;else return setTimeout(function(){e(t)},300);var r=new pe,n=r.create("dir",Ze),i=r.create("dir",n),s=r.create("file",i);r.mkdir(n,i);var o={recursive:!0},c;try{c=b.watch(n,o)}catch(u){if(u.code=="ERR_FEATURE_UNAVAILABLE_ON_PLATFORM")return t(E=!1);throw u}if(!c)return!1;var a=setTimeout(function(){c.close(),r.cleanup(function(){t(E=!1)})},200);c.on("change",function(u,d){I.basename(s)===I.basename(d)&&(c.close(),clearTimeout(a),r.cleanup(function(){t(E=!0)}))}),r.write(s)}});var Ee=v((Ct,j)=>{var U=p("fs"),_=p("path"),he=p("util"),me=p("events"),ge=de(),l=F(),et="update",ye="remove",C=Symbol("skip");function tt(e){return e.some(function(t,r,n){return n.indexOf(t)!==r})}function M(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}function rt(e){return e.reduce(function(t,r){return t.concat(r)},[])}function nt(e){if(e&&e!=="buffer"&&!Buffer.isEncoding(e))throw new Error("Unknown encoding: "+e)}function it(e){return function(t,r){if(l.func(e)){var n=e(t,C);n&&n!==C&&r()}else l.regExp(e)?e.test(t)&&r():r()}}function st(e){return e.map(function(t){return l.exists(t)?[et,t]:[ye,t]})}function ot(e){var t=M(e),r=/~$|^\.#|^##$/g,n=e.some(function(s){return r.test(s)});if(n){var i=tt(e.map(function(s){return s.replace(r,"")}));i&&(t=t.filter(function(s){return l.exists(s)}))}return st(t)}function ct(e,t){var r,n=[],i=e.options.encoding,s=e.options.delay;l.number(s)||(s=200);function o(){ot(n).forEach(function(c){c[1]=Buffer.from(c[1]),i!=="buffer"&&(c[1]=c[1].toString(i)),t.apply(null,c)}),r=null,n=[]}return function(c,a){n.push(a),r||(r=setTimeout(o,s))}}function ve(){var e={};return function(t){return function(r,n){e[r+n]=[r,n],setTimeout(function(){Object.keys(e).forEach(function(i){t.apply(null,e[i])}),e={}})}}}function we(e,t,r=function(){}){l.directory(e)?U.readdir(e,function(n,i){if(n)if(/^(EPERM|EACCES)$/.test(n.code))console.warn("Warning: Cannot access %s.",e);else throw n;else i.forEach(function(s){var o=_.join(e,s);l.directory(o)&&t(o)}),r()}):r()}function at(e){var t=0;return function(){return t++,function(){t--,t===0&&e()}}}function ut(){return function(){}}function Se(e,t){return!l.func(t)||t(e,C)!==C}var xe=he.deprecate(function(){},"(node-watch) First param in callback function  is replaced with event name since 0.5.0, use  `(evt, filename) => {}` if you want to get the filename");function m(){me.EventEmitter.call(this),this.watchers={},this._isReady=!1,this._isClosed=!1}he.inherits(m,me.EventEmitter);m.prototype.expose=function(){var e={},t=this,r=["on","emit","once","close","isClosed","listeners","setMaxListeners","getMaxListeners","getWatchedPaths"];return r.forEach(function(n){e[n]=function(){return t[n].apply(t,arguments)}}),e};m.prototype.isClosed=function(){return this._isClosed};m.prototype.close=function(e){var t=this;if(e){var r=this.watchers[e];r&&r.close&&(r.close(),delete t.watchers[e]),we(e,function(n){t.close(n)})}else Object.keys(t.watchers).forEach(function(n){var i=t.watchers[n];i&&i.close&&i.close()}),this.watchers={};l.emptyObject(t.watchers)&&(this._isClosed||(this._isClosed=!0,process.nextTick(ke,this)))};m.prototype.getWatchedPaths=function(e){if(l.func(e)){var t=this;t._isReady?e(Object.keys(t.watchers)):t.on("ready",function(){e(Object.keys(t.watchers))})}};function L(e){e._isReady||(e._isReady=!0,process.nextTick(function(){e.emit("ready")}))}function ke(e){e.emit("close")}m.prototype.add=function(e,t){var r=this;t=t||{fpath:""};var n=_.resolve(t.fpath);this.watchers[n]=e;var i=function(o,c){if(!r.isClosed()){var a=c;l.nil(a)&&(a=""),a=_.join(t.fpath,a),t.options.recursive&&ge(function(u){if(!u){var d=_.resolve(a);if(!l.exists(a))r.close(d);else{var D=l.directory(a)&&!r.watchers[d]&&Se(a,t.options.filter);D&&r.watchDirectory(a,t.options)}}}),s(o,a)}},s=ct(t,function(o,c){if(t.compareName)t.compareName(c)&&r.emit("change",o,c);else{var a=it(t.options.filter);a(c,function(){r.flag?r.flag="":r.emit("change",o,c)})}});e.on("error",function(o){r.isClosed()||(l.windows()&&o.code==="EPERM"?(e.emit("change",ye,t.fpath&&""),r.flag="windows-error",r.close(n)):r.emit("error",o))}),e.on("change",i)};m.prototype.watchFile=function(e,t,r){var n=_.join(e,"../"),i=Object.assign({},t,{filter:null,encoding:"utf8"});delete i.recursive;var s=U.watch(n,i);this.add(s,{type:"file",fpath:n,options:Object.assign({},i,{encoding:t.encoding}),compareName:function(o){return l.samePath(o,e)}}),l.func(r)&&(r.length===1&&xe(),this.on("change",r))};m.prototype.watchDirectory=function(e,t,r,n=ut){var i=this,s=n();ge(function(o){t.recursive=!!t.recursive;var c=Object.assign({},t,{encoding:"utf8"});if(o||delete c.recursive,i._isClosed)return s(),i.close();var a=U.watch(e,c);i.add(a,{type:"dir",fpath:e,options:t}),l.func(r)&&(r.length===1&&xe(),i.on("change",r)),t.recursive&&!o&&we(e,function(u){Se(u,t.filter)&&i.watchDirectory(u,t,null,n)},n()),s()})};function lt(e){var t=new m,r=ve(),n=e.length;return e.forEach(function(i){i.on("change",r(function(s,o){t.emit("change",s,o)})),i.on("error",function(s){t.emit("error",s)}),i.on("ready",function(){--n||L(t)})}),t.close=function(){e.forEach(function(i){i.close()}),process.nextTick(ke,t)},t.getWatchedPaths=function(i){if(l.func(i)){var s=e.map(function(o){return new Promise(function(c){o.getWatchedPaths(c)})});Promise.all(s).then(function(o){var c=M(rt(o));i(c)})}},t.expose()}function N(e,t,r){var n=new m;if(l.buffer(e)&&(e=e.toString()),!l.array(e)&&!l.exists(e)&&n.emit("error",new Error(e+" does not exist.")),l.string(t)&&(t={encoding:t}),l.func(t)&&(r=t,t={}),arguments.length<2&&(t={}),t.encoding?nt(t.encoding):t.encoding="utf8",l.array(e)){if(e.length===1)return N(e[0],t,r);var i=ve();return lt(M(e).map(function(o){var c=N(o,t);return l.func(r)&&c.on("change",i(r)),c}))}if(l.file(e))n.watchFile(e,t,r),L(n);else if(l.directory(e)){var s=at(function(){L(n)});n.watchDirectory(e,t,r,s)}return n.expose()}j.exports=N;j.exports.default=N});var Oe=v(($t,_e)=>{var pt=p("child_process").spawn;_e.exports=function(e,t){let r=new Set([parseInt(e,10)]);var n="";let i=pt("ps",["-A","-o","ppid,pid"]);i.stdout.on("data",s=>{n+=s.toString("ascii")}),i.on("close",()=>{try{let s=n.split(`
`).slice(1).map(o=>o.trim()).reduce((o,c)=>{let a=c.split(/\s+/),u=parseInt(a[0],10);if(r.has(u)){let d=parseInt(a[1],10);o.push(d),r.add(d)}return o},[]);t(null,s)}catch(s){t(s,null)}})}});var Ae=v((Dt,Pe)=>{var ft=p("child_process").spawn;Pe.exports={tree:mt,pidsForTree:gt,getStat:dt};function dt(){return new Promise(e=>{let r=ft("sh",["-c","ls /proc | grep -E '^[0-9]+$' | xargs -I{} cat /proc/{}/stat"],{stdio:["pipe","pipe","pipe"]});var n="";r.stdout.on("data",i=>n+=i),r.on("close",()=>e(n))})}function ht(e){var t=null;return e.replace(/(\d+) \((.*?)\)\s(.+?)\s(\d+)\s/g,(r,n,i,s,o)=>{t={PID:n,COMMAND:i,PPID:o,STAT:s}}),t}function mt(e){return e.split(`
`).map(ht).filter(Boolean)}function gt(e,t){typeof t=="number"&&(t=t.toString());let r=[t],n=[];return e.forEach(i=>{r.indexOf(i.PPID)!==-1&&(r.push(i.PID),n.push(i))}),n}});var Ce=v((Wt,w)=>{var yt=p("child_process").exec,vt=Oe(),J=Ae(),V=!0;yt("ps",e=>{w.exports.hasPS=V=!e});w.exports=function(t,r){if(typeof t=="number"&&(t=t.toString()),V&&!process.env.NO_PS)return vt(t,r);J.getStat().then(J.tree).then(n=>J.pidsForTree(n,t)).then(n=>r(null,n.map(i=>i.PID))).catch(n=>r(n))};w.parent||w.exports(process.argv[2],(e,t)=>console.log(t));w.exports.hasPS=V});var kt={};Je(kt,{default:()=>xt});var y=p("@yarnpkg/core"),$=p("@yarnpkg/cli"),x=p("clipanion");var f=W(ee()),ze=f.M.union(f.M.lit("wait"),f.M.lit("kill"),f.M.lit("restart")),Ge=f.M.rec(e=>f.M.union(f.M.str,f.M.arr(e),f.M.obj({watch:f.M.opt(f.M.arr(f.M.str)),onExit:f.M.opt(ze),script:e}))),T=(e,t)=>{if(typeof e=="string"&&e.slice(0,2)==="r:"){let[r,n]=e.slice(2).split("->");return n===void 0?{kind:"script-reference",scriptName:r}:{kind:"script-reference",packageName:r,scriptName:n}}else{if(typeof e=="string")return{kind:"shell-script",value:e,workingDirectory:t};if(Array.isArray(e))return{kind:"script-sequence",scripts:e.map(r=>T(r,t)).filter(r=>r!==void 0)};if(typeof e=="object"){let{watch:r,onExit:n,script:i}=e,s=T(i,t);return s===void 0?void 0:{...s,watch:r,onExit:n}}else{console.warn("Found invalid script definition",e);return}}},Qe=(e,t)=>{let r=new Map;for(let n of Object.keys(e)){let i=e[n];try{(0,f.marshal)(i,Ge,n);let s=T(i,t);s!==void 0&&r.set(n,s)}catch(s){s instanceof f.MarshalError&&console.warn(s.message)}}return r},te=e=>{let t=new Map;for(let r of e){let n=r.manifest,i=Object.assign({},n.raw.scripts,n.raw.r);for(let[s,o]of Qe(i,r.cwd).entries()){t.has(s)||t.set(s,new Map);let c=n.raw.name??"__unnamed";t.get(s).set(c,o)}}return t};var re=p("@yarnpkg/core");function R(e,t,r){return Array.isArray(r)?r.map(n=>R(e,t,n)):{...r,watch:r.watch.concat(e),onExit:r.onExit??t}}function ne(e){let t=[];for(let r of e)Array.isArray(r)?t.push(...r):t.push(r);return t}function ie(e,t){switch(e.kind){case"shell-script":return{kind:"resolved",watch:e.watch??[],workingDirectory:e.workingDirectory,script:e.value,onExit:e.onExit};case"script-reference":{let r=se(e.scriptName,e.packageName,t);return r?R(e.watch??[],e.onExit,r):{kind:"unresolved",command:e.scriptName,watch:e.watch??[],onExit:e.onExit}}case"script-sequence":{let r=e.scripts.map(n=>ie(n,t)).filter(n=>n!==void 0).map(n=>R(e.watch??[],e.onExit,n));return ne(r)}}}function se(e,t,r){let n=r.get(e);if(!n)return{kind:"unresolved",command:e,watch:[]};let i=t?n.get(t):[...n.values()][0];return i?ie(i,r):{kind:"unresolved",command:e,watch:[]}}var oe=async(e,t,r,n,i,s)=>{let o=se(e,void 0,r),a=ne([o]).map(u=>["--command",JSON.stringify(u)]).reduce((u,d)=>[...u,...d],["_r_internal_1","--args",JSON.stringify(t)]);re.scriptUtils.executePackageShellcode(n,"yarn",a,{project:i,...s})};var Re=p("child_process");var We=W(Ee()),Te=W(p("path"));var be=e=>new Promise(t=>setTimeout(t,e));console.log=()=>{};var Ne=Ce(),$e=(e,t)=>{try{process.kill(e,t)}catch(r){if(r&&Object.hasOwnProperty.call(r,"code")&&r.code==="ESRCH")return;throw r}},De=async(e,t)=>{let n=(await new Promise((i,s)=>{if(!Ne.hasPS)return i([]);Ne(e,(...o)=>{if(o[0])return s(o[0]);i(o[1])})})).sort((i,s)=>s-i);for(let i of n)$e(i,t);$e(e,t)},H=()=>{let e,t=async()=>{if(e===void 0){let n;return e=new Promise(i=>{n=()=>{i(),e=void 0}}),n}return await e,t()};return Object.assign(t,{isAvailable:()=>e===void 0})},S=class{constructor(t,r,n,i){this.processLock=H();this.script=t,this.additionalArgs=r,this.print=i,this.closeBehavior=n,this.onClose=this.onClose.bind(this)}get command(){return this.script.kind==="resolved"?"yarn":this.script.command}get args(){return this.script.kind==="resolved"?["_r_internal_2","--command",JSON.stringify(this.script.script+" "+this.additionalArgs.join(" "))]:this.additionalArgs}get cwd(){return this.script.kind==="resolved"?this.script.workingDirectory:void 0}async onClose(t){t&&this.print(`Process exited with code ${t}
`),this.proc=void 0,this.closeBehavior.kind==="restart"?this.start():this.closeBehavior.kind==="callback"&&this.closeBehavior.onClose()}startWatching(){if(!this.watcher&&this.script.watch.length>0){let t=this.script.kind==="resolved"?this.script.workingDirectory:process.cwd(),r=this.script.watch.map(n=>Te.join(t,n));this.watcher=(0,We.default)(r,{recursive:!0},async()=>{this.processLock.isAvailable()&&(this.print(`Restarting due to file change
`),this.start())})}}async start(){let t=await this.processLock();await this.kill();let r=this._start();r.on("close",this.onClose),this.proc=r,this.startWatching(),t()}async kill(){let t=this.proc;if(t===void 0)return;t.off("close",this.onClose);let r=new Promise(n=>{t.on("close",()=>n()),De(t.pid,15)});(async()=>(await be(2e3),this.proc===t&&De(t.pid,9)))(),await r,this.proc=void 0}};var K=class extends S{_start(){let t=(0,Re.spawn)(this.command,this.args,{cwd:this.cwd});return t.stdout.on("data",async r=>{await this.print(r.toString())}),t.stderr.on("data",async r=>{await this.print(r.toString())}),t}},wt=e=>{let t=H();return r=>async n=>{let i=await t();e.stdout.write(`${r} ${n}`),n.slice(-1)[0]!==`
`&&e.stdout.write(`
`),i()}},qe=async(e,t,r)=>{let n=wt(r),i=e.map((s,o)=>{let c=s.onExit==="kill"?{kind:"callback",onClose:()=>{i.forEach(a=>a.kill())}}:s.onExit==="restart"?{kind:"restart"}:{kind:"wait"};return new K(s,t,c,n(`[${o}]`))});for(let s of i)s.start();return i};var Be=p("child_process");var z=class extends S{_start(){return(0,Be.spawn)(this.command,this.args,{stdio:"inherit",cwd:this.cwd})}},Fe=async(e,t)=>{let r=e.onExit==="kill"?{kind:"callback",onClose:()=>{process.exit(0)}}:e.onExit==="restart"?{kind:"restart"}:{kind:"wait"},n=new z(e,t,r,i=>(process.stdout.write(`[r] ${i}`),Promise.resolve()));return n.start(),n};var G=class extends $.BaseCommand{constructor(){super(...arguments);this.command=x.Option.String({name:"command"});this.arguments=x.Option.Proxy({name:"arguments"})}static{this.paths=[["r"]]}async execute(){let r=await y.Configuration.find(this.context.cwd,this.context.plugins),{project:n,locator:i}=await y.Project.find(r,this.context.cwd);await n.restoreInstallState();let s=te(n.workspaces),o={stdout:this.context.stdout,stderr:this.context.stderr,stdin:this.context.stdin};await oe(this.command,this.arguments,s,i,n,o)}},Q=class extends $.BaseCommand{constructor(){super(...arguments);this.scripts=x.Option.Array("--command");this.args=x.Option.String("--args")}static{this.paths=[["_r_internal_1"]]}async execute(){let r=(this.scripts??[]).map(i=>JSON.parse(i)),n=JSON.parse(this.args??"[]");r.length===1?Fe(r[0],n):qe(r,n,this.context)}},X=class extends $.BaseCommand{constructor(){super(...arguments);this.command=x.Option.String("--command")}static{this.paths=[["_r_internal_2"]]}async execute(){let r=await y.Configuration.find(this.context.cwd,this.context.plugins),{project:n,locator:i}=await y.Project.find(r,this.context.cwd);await n.restoreInstallState();let s={stdout:this.context.stdout,stderr:this.context.stderr,stdin:this.context.stdin};y.scriptUtils.executePackageShellcode(i,"/bin/sh",["-c",JSON.parse(this.command??'""')],{project:n,...s})}},St={commands:[G,Q,X]},xt=St;return Ve(kt);})();
return plugin;
}
};
